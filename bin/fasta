#!/usr/bin/env python

import csv
import hashlib

import click
from Bio import SeqIO


@click.group()
def main():
    pass


@main.group()
def md5():
    pass


@md5.command('display')
@click.argument('filename', type=click.File(mode='rb'))
@click.argument('save', type=click.File(mode='wb'))
def md5_display(filename, save):
    writer = csv.writer(save, delimiter='\t')
    for record in SeqIO.parse(filename, 'fasta'):
        seq = str(record.seq)
        md5 = hashlib.md5(str(record.seq)).hexdigest()
        print((record.id, seq, md5))
        writer.writerow([record.id, md5])


@md5.command('validate')
@click.argument('filename', type=click.File(mode='rb'))
@click.argument('correct', type=click.File(mode='rb'))
@click.argument('save', type=click.File(mode='wb'))
def md5_validate(filename, correct, save):
    correct = {r[0]: r[1] for r in csv.reader(correct, delimiter='\t')}
    writer = csv.writer(save, delimiter='\t')
    for row in csv.reader(filename, delimiter='\t'):
        status = 'OK' if row[1] == correct[row[0]] else 'NOT OK'
        writer.writerow((row[0], status))


if __name__ == '__main__':
    main()
